<!-- src/app/pages/bookings/bookings.component.html -->
<mat-card>
  <mat-card-title>Bookings</mat-card-title>
  <mat-card-content>
    <form class="filters" [formGroup]="filter" (ngSubmit)="load()">
      <mat-form-field appearance="outline">
        <mat-label>Hotel</mat-label>
        <mat-select formControlName="hotelId">
          <mat-option *ngFor="let h of hotels" [value]="h.id">{{ h.code }} - {{ h.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>From</mat-label>
        <input matInput [matDatepicker]="f1" formControlName="from" />
        <mat-datepicker-toggle matIconSuffix [for]="f1"></mat-datepicker-toggle>
        <mat-datepicker #f1></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>To</mat-label>
        <input matInput [matDatepicker]="f2" formControlName="to" />
        <mat-datepicker-toggle matIconSuffix [for]="f2"></mat-datepicker-toggle>
        <mat-datepicker #f2></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option value="">All</mat-option>
          <mat-option value="C">C</mat-option>
          <mat-option value="X">X</mat-option>
          <mat-option value="P">P</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit">Load</button>
    </form>

    <mat-divider></mat-divider>

    <form class="create" [formGroup]="form" (ngSubmit)="create()">
      <mat-form-field appearance="outline">
        <mat-label>Hotel</mat-label>
        <mat-select formControlName="hotelId" (selectionChange)="onHotelChangeForCreate()">
          <mat-option *ngFor="let h of hotels" [value]="h.id">{{ h.code }} - {{ h.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Room Type</mat-label>
        <mat-select formControlName="roomTypeId">
          <mat-option *ngFor="let rt of roomTypes" [value]="rt.id">{{ rt.code }} - {{ rt.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Check-in</mat-label>
        <input matInput [matDatepicker]="c1" formControlName="checkIn" />
        <mat-datepicker-toggle matIconSuffix [for]="c1"></mat-datepicker-toggle>
        <mat-datepicker #c1></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Check-out</mat-label>
        <input matInput [matDatepicker]="c2" formControlName="checkOut" />
        <mat-datepicker-toggle matIconSuffix [for]="c2"></mat-datepicker-toggle>
        <mat-datepicker #c2></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline"><mat-label>Rooms</mat-label><input matInput type="number" formControlName="rooms" /></mat-form-field>
      <mat-form-field appearance="outline"><mat-label>Customer</mat-label><input matInput formControlName="customerName" /></mat-form-field>
      <mat-form-field appearance="outline"><mat-label>Notes</mat-label><input matInput formControlName="notes" /></mat-form-field>

      <button mat-raised-button color="primary" type="submit">Create</button>
    </form>

    <div class="table-wrap" *ngIf="!loading; else spin">
      <table mat-table [dataSource]="data" class="mat-elevation-z0 full">
        <ng-container matColumnDef="ref"><th mat-header-cell *matHeaderCellDef>Ref</th><td mat-cell *matCellDef="let r">{{ r.bookingRef }}</td></ng-container>
        <ng-container matColumnDef="hotel"><th mat-header-cell *matHeaderCellDef>Hotel</th><td mat-cell *matCellDef="let r">{{ r.hotelCode }} - {{ r.hotelName }}</td></ng-container>
        <ng-container matColumnDef="room"><th mat-header-cell *matHeaderCellDef>Room</th><td mat-cell *matCellDef="let r">{{ r.roomTypeCode }}</td></ng-container>
        <ng-container matColumnDef="dates"><th mat-header-cell *matHeaderCellDef>Dates</th><td mat-cell *matCellDef="let r">{{ r.checkIn }} â†’ {{ r.checkOut }}</td></ng-container>
        <ng-container matColumnDef="qty"><th mat-header-cell *matHeaderCellDef>Rooms</th><td mat-cell *matCellDef="let r">{{ r.rooms }}</td></ng-container>
        <ng-container matColumnDef="status"><th mat-header-cell *matHeaderCellDef>Status</th><td mat-cell *matCellDef="let r">{{ r.status }}</td></ng-container>
        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let r">
            <button mat-button color="warn" (click)="cancel(r)" [disabled]="r.status==='X'">Cancel</button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['ref','hotel','room','dates','qty','status','act']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['ref','hotel','room','dates','qty','status','act'];"></tr>
      </table>

      <mat-paginator [length]="total" [pageSize]="pageSize" [pageIndex]="pageIndex"
                     [pageSizeOptions]="[5,10,25,50]" (page)="onPage($event)">
      </mat-paginator>
    </div>

    <ng-template #spin>
      <div class="center"><mat-spinner diameter="32"></mat-spinner></div>
    </ng-template>
  </mat-card-content>
</mat-card>
